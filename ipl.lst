     1                                  ; hello-os
     2                                  ; TAB=4
     3                                  
     4                                      ORG     0x7c00          ; このプログラムが何処によみこまれるのか
     5                                  
     6                                  ; 以下は標準的なFAT12フォーマットフロッピーディスクのための記述
     7                                  
     8 00000000 EB48                        JMP     entry
     9 00000002 90                          DB      0x90
    10 00000003 48454C4C4F49504C            DB      "HELLOIPL"
    11 0000000B 0002                        DW      512             ; 1セクタの大きさ                           (512にしなければならない)
    12 0000000D 01                          DB      1               ; クラスタの大きさ                          (1セクタにしなければならない)
    13 0000000E 0100                        DW      1               ; FATがどこから始まるか                     (普通は1セクタ目からにする)
    14 00000010 02                          DB      2               ; FATの個数                                 (2にしなければならない)
    15 00000011 E000                        DW      224             ; ルートディレクトリ領域の大きさ            (普通は224エントリにする)
    16 00000013 400B                        DW      2880            ; このドライブの大きさ                      (2880セクタにしなければならない)
    17 00000015 F0                          DB      0xf0            ; メディアタイプ                            (0xf0にしなければならない)
    18 00000016 0900                        DW      9               ; FAT領域の長さ                             (9セクタにしなければならない)
    19 00000018 1200                        DW      18              ; 1トラックにいくつのセクタがあるか         (18にしなければならない)
    20 0000001A 0200                        DW      2               ; ヘッドの数                                (2にしなければならない)
    21 0000001C 00000000                    DD      0               ; パーティションを使っていないのでここは必ず0
    22 00000020 400B0000                    DD      2880            ; このドライブの大きさをもう一度書く
    23 00000024 000029                      DB      0, 0, 0x29      ; よくわからないけどこの値にしておくといいらしい
    24 00000027 FFFFFFFF                    DD      0xffffffff      ; たぶんボリュームシリアル番号
    25 0000002B 48454C4C4F2D4F53            DB      "HELLO-OS"      ; ディスクの名前                            (11Byte)
    26 00000033 4641543132                  DB      "FAT12"         ; フォーマットの名前                        (8Byte)
    27 00000038 <res 00000012>              RESB    18              ; とりあえず18バイト開けておく
    27          ******************       warning: uninitialized space declared in .text section: zeroing
    28                                  
    29                                  ; Program Main Body
    30                                  
    31                                  entry:
    32 0000004A B80000                      MOV     AX,0            ; レジスタ初期化
    33 0000004D 8ED0                        MOV     SS,AX
    34 0000004F BC007C                      MOV     SP,0x7c00
    35 00000052 8ED8                        MOV     DS,AX
    36                                      ; MOV     ES,AX
    37                                  
    38                                      ; MOV     SI,msg
    39                                  
    40                                  ; Read disk
    41                                  
    42 00000054 B82008                      MOV     AX,0x0820
    43 00000057 8EC0                        MOV     ES,AX
    44 00000059 B500                        MOV     CH,0            ; シリンダ0
    45 0000005B B600                        MOV     DH,0            ; ヘッド0
    46 0000005D B102                        MOV     CL,2            ; セクタ2
    47                                  
    48 0000005F B402                        MOV     AH,0x02         ; AH=0x02 : ディスク読み込み
    49 00000061 B001                        MOV     AL,1            ; 1セクタ
    50 00000063 BB0000                      MOV     BX,0
    51 00000066 B200                        MOV     DL,0x00         ; Aドライブ
    52 00000068 CD13                        INT     0x13            ; ディスクBIOS呼び出し
    53 0000006A 7203                        JC      error
    54                                  
    55                                  fin:
    56 0000006C F4                          HLT                     ; 何かあるまでCPUを停止させる
    57 0000006D EBFD                        JMP     fin             ; 無限ループ
    58                                  
    59                                  error:
    60 0000006F BE[8400]                    MOV     SI,msg
    61                                  
    62                                  putloop:
    63 00000072 8A04                        MOV     AL,[SI]
    64 00000074 83C601                      ADD     SI,1            ; SIに1を足す
    65 00000077 3C00                        CMP     AL,0
    66 00000079 74F1                        JE      fin
    67 0000007B B40E                        MOV     AH,0x0e         ; 一文字表示ファンクション
    68 0000007D BB0F00                      MOV     BX,15           ; カラーコード
    69 00000080 CD10                        INT     0x10            ; ビデオBIOS呼び出し
    70 00000082 EBEE                        JMP     putloop
    71                                  
    72                                  msg:
    73 00000084 0A0A                        DB      0x0a, 0x0a      ; 改行を2つ
    74 00000086 68656C6C6F2C20776F-         DB      "hello, world"
    74 0000008F 726C64             
    75 00000092 0A                          DB      0x0a            ; 改行
    76 00000093 00                          DB      0
    77                                  
    78                                      ;RESB    0x7dfe-$        ; エラーになる。。。
    79 00000094 <res 0000016A>              RESB	0x7dfe-0x7c00-($-$$)		; 0x7dfeまでを0x00で埋める命令
    79          ******************       warning: uninitialized space declared in .text section: zeroing
    80 000001FE 55AA                        DB      0x55, 0xaa
    81                                  
    82                                  
    83                                  ; 以下はブートセクタ以外の部分の記述
    84                                  
    85 00000200 F0FFFF0000000000            DB      0xf0, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00
    86 00000208 <res 000011F8>              RESB    4600
    86          ******************       warning: uninitialized space declared in .text section: zeroing
    87 00001400 F0FFFF0000000000            DB      0xf0, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00
    88 00001408 <res 00166BF8>              RESB    1469432
    88          ******************       warning: uninitialized space declared in .text section: zeroing
